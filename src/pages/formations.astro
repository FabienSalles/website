---
import Layout from '../layouts/Layout.astro';
import { getAllRecommendations, getStats } from '../data/formations';

// Récupère une recommandation aléatoire pour le témoignage
const allRecommendations = getAllRecommendations();
const randomReco = allRecommendations[Math.floor(Math.random() * allRecommendations.length)];

// Labels pour les noms de formations
const formationLabels: Record<string, string> = {
  phpunit: 'PHPUnit',
  git: 'Git',
  ddd: 'DDD',
  symfony: 'Symfony',
  sql: 'SQL'
};

// Stats dynamiques depuis les données
const dataStats = getStats();

const formations = [
  {
    slug: 'phpunit',
    title: 'PHPUnit : écrire des tests qui durent',
    hook: 'Arrête de subir tes tests.<br />Fais-en des alliés.',
    problem: 'Tes tests cassent sans raison ? Ils prennent trop de temps à écrire et à maintenir ?',
    promise: 'En 2 jours, apprends à écrire des tests qui te font gagner du temps au lieu d\'en perdre.',
    highlights: [
      'Ce qu\'est vraiment un test unitaire',
      'Maîtriser Mocks, Stubs, Fakes',
      'Savoir quand et quoi tester',
      'Écrire des tests qui durent'
    ],
    duration: '2 jours',
    featured: false
  },
  {
    slug: 'git',
    title: 'Git avancé',
    hook: 'Arrête de subir Git.<br />Reprends le contrôle de ton historique.',
    problem: 'Tu utilises Git tous les jours mais tu ne le comprends pas vraiment ?',
    promise: 'Passe de "ça marche je sais pas pourquoi" à "je sais exactement ce que je fais".',
    highlights: [
      'Branches, merge et rebase sans stress',
      'Résoudre les conflits sereinement',
      'Choisir le bon workflow d\'équipe',
      'Techniques avancées : bisect, reflog, squash, fixup',
      'Worktree et autres outils avancés'
    ],
    duration: '2 jours',
    featured: false
  },
  {
    slug: 'ddd',
    title: 'Domain-Driven Design',
    hook: 'Arrête de subir ton organisation.<br />Aligne-la avec tes besoins.',
    problem: 'Le métier et la tech ne se comprennent pas ? Tu subis un couplage qui crée des régressions ?',
    promise: 'Aligne ton équipe technique et produit pour livrer ce qui compte vraiment.',
    highlights: [
      'Aligne équipe tech et produit',
      'Comprends les problèmes pour trouver les bonnes solutions',
      'Isole ton code et ton équipe correctement',
      'Mets en avant la complexité métier et mets de côté celle qui te gêne'
    ],
    duration: '3 à 5 jours',
    featured: false
  }
];

const stats = {
  developers: `${dataStats.participants}+`,
  sessions: `${dataStats.sessions}+`,
  since: '2016'
};
---

<Layout
  title="Formations PHPUnit, Git, DDD - Fabien Salles"
  description="Des formations pratiques pour arrêter de subir tes outils. PHPUnit, Git, DDD : en 2 à 5 jours, maîtrise vraiment ce que tu utilises tous les jours."
>
  <div class="container mx-auto px-4 py-12">

    <!-- HERO SECTION -->
    <section class="text-center py-12 mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">
        Arrête de subir ton environnement.<br>
        <span class="text-orange-700">Maîtrise-le vraiment.</span>
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-4 leading-relaxed">
        Des formations pratiques, sans bullshit, pour ceux qui veulent comprendre
        ce qu'ils font.
      </p>
      <!-- Stats inline -->
      <div class="flex flex-wrap justify-center gap-8 text-sm text-gray-600 mb-8">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-gray-900">{stats.developers}</span>
          <span>développeurs formés</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-gray-900">{stats.sessions}</span>
          <span>sessions depuis {stats.since}</span>
        </div>
      </div>
    </section>

    <!-- FORMATIONS GRID -->
    <section id="formations" class="mb-16 scroll-mt-8 bg-gradient-to-br from-orange-900 to-orange-800 -mx-4 px-4 py-16 md:rounded-lg md:mx-0 md:px-12">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {formations.map((formation) => (
          <div class="p-8 bg-orange-50 rounded-xl shadow-lg hover:shadow-xl transition-shadow flex flex-col">
            {formation.featured && (
              <div class="text-xs font-semibold text-orange-700 uppercase tracking-wide mb-2">
                Formation phare
              </div>
            )}

            <!-- Header -->
            <div class="mb-6 pb-4 border-b border-orange-200">
              <h2 class="text-2xl font-bold text-gray-900">
                {formation.title}
              </h2>
            </div>

            <!-- Hook -->
            <p class="text-gray-800 mb-6 font-medium" set:html={formation.hook} />

            <!-- Problem -->
            <p class="text-gray-700 mb-5 leading-relaxed">
              {formation.problem}
            </p>

            <!-- Promise (quote style) -->
            <div class="bg-white rounded-lg p-4 mb-5 border-l-4 border-orange-400">
              <p class="text-gray-600 text-sm italic">
                {formation.promise}
              </p>
            </div>

            <!-- Highlights -->
            <ul class="space-y-2 text-gray-700 text-sm mb-6 flex-grow">
              {formation.highlights.map((item) => (
                <li class="flex items-start gap-2">
                  <span class="text-orange-600 mt-0.5">✓</span>
                  <span>{item}</span>
                </li>
              ))}
            </ul>

            <!-- Footer -->
            <div class="mt-auto pt-4 border-t border-orange-200 flex items-center justify-between">
              <span class="text-sm font-medium text-gray-700">
                {formation.duration}
              </span>
              <a
                href={`/formations/${formation.slug}`}
                class="inline-block bg-orange-700 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-orange-800 transition-colors"
              >
                Découvrir →
              </a>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- TÉMOIGNAGE COURT -->
    <section class="mb-16 bg-gray-50 -mx-4 px-4 py-10 md:rounded-lg md:mx-0 md:px-12">
      <div class="max-w-3xl mx-auto">
        <blockquote class="text-center">
          <p class="text-xl text-gray-700 mb-6 leading-relaxed">
            "{randomReco.recommendation}"
          </p>
          <footer class="text-gray-600">
            <span class="font-semibold">{randomReco.name}</span> — Participant formation {formationLabels[randomReco.formationName] || randomReco.formationName}
          </footer>
        </blockquote>
        <div class="text-center mt-6">
          <a href="/recommendations#formations" class="text-orange-700 font-semibold hover:text-orange-800">
            Voir toutes les recommandations →
          </a>
        </div>
      </div>
    </section>

    <!-- FORMATION SUR MESURE -->
    <section class="mb-16">
      <div class="bg-gradient-to-br from-orange-900 to-orange-800 text-white p-8 md:p-12 rounded-lg">
        <div class="max-w-3xl">
          <h2 class="text-2xl md:text-3xl font-bold mb-4">
            Formation sur mesure
          </h2>
          <p class="text-orange-100 text-lg mb-8 leading-relaxed">
            Je peux adapter mes formations à tes besoins spécifiques et au niveau de ton équipe.
            N'hésite pas à me contacter pour discuter de tes objectifs.
          </p>
          <a
            href="/contact?subject=formation-sur-mesure"
            class="inline-block bg-white text-orange-900 px-6 py-3 rounded-lg font-semibold hover:bg-orange-50 transition-colors"
          >
            On en discute ?
          </a>
        </div>
      </div>
    </section>

    <!-- INFO NDA (discret mais présent) -->
    <section class="text-center text-sm text-gray-500 border-t border-gray-200 pt-8">
      <p>
        <strong class="text-gray-700">Organisme de formation déclaré</strong> —
        Numéro de déclaration d'activité (NDA) auprès de la DREETS.
        Formations exonérées de TVA (article 261-4-4°a du CGI).
      </p>
    </section>

  </div>
</Layout>
